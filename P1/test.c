#include <stdlib.h>
#include <stdio.h>
#include "aes.h"

void testKeyExpansion();
void testEncrypt();
void testDecrypt();

int main() {
    printf("? TESTING aes ...\n");
    testKeyExpansion();
    testEncrypt();
    testDecrypt();
    printf("+ FINISHED aes\n");
    return 0;
}

void testKeyExpansion() {
    printf("? \tTESTING keyExpansion ...\n");
    unsigned char key[16] = {
        0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c
    };
    unsigned char** expKey = keyExpansion(key, 16/4, 10);
    for (int i = 0; i < 4*(10+1); i++) {
        printf("\t\t");
        for (int j = 0; j < 4; j++) {
            printf("%02x", expKey[j][i]);
        }
        printf("\n");
    }
    printf("+ \tFINISHED keyExpansion\n");
}

void testEncrypt() {
    printf("? \tTESTING encrypt ...\n");
    unsigned char key[17] = {
        0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c,0x00
    };
    unsigned char input[17] = {
        0x32,0x43,0xf6,0xa8,0x88,0x5a,0x30,0x8d,0x31,0x31,0x98,0xa2,0xe0,0x37,0x07,0x34,0x00
    };
    unsigned char output[17] = {
        0x39,0x25,0x84,0x1d,0x02,0xdc,0x09,0xfb,0xdc,0x11,0x85,0x97,0x19,0x6a,0x0b,0x32,0x00
    };
    unsigned char* ciphertext = encrypt(key, input);
    for (int i = 0; i < 16; i++) {
        if (ciphertext[i] != output[i]) {
            printf("! \t\tEXPECTED %d RECEIVED %d, (%d)\n", output[i], ciphertext[i], i);
        }
    }
    printf("+ \tFINISHED encrypt\n");
}

void testDecrypt() {
    printf("? \tTESTING decrypt ...\n");
    unsigned char key[17] = {
        0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c,0x00
    };
    unsigned char input[17] = {
        0x39,0x25,0x84,0x1d,0x02,0xdc,0x09,0xfb,0xdc,0x11,0x85,0x97,0x19,0x6a,0x0b,0x32,0x00
    };
     unsigned char output[17] = {
        0x32,0x43,0xf6,0xa8,0x88,0x5a,0x30,0x8d,0x31,0x31,0x98,0xa2,0xe0,0x37,0x07,0x34,0x00
    };
    unsigned char* plaintext = decrypt(key, input);
    for (int i = 0; i < 16; i++) {
        if (plaintext[i] != output[i]) {
            printf("! \t\tEXPECTED %d RECEIVED %d, (%d)\n", output[i], plaintext[i], i);
        }
    }
    printf("+ \tFINISHED decrypt\n");
}